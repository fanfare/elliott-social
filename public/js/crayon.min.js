function randint(e,t){return~~(Math.random()*(t-e+1))+e}var abacabindex=0,abacab=["70","30","60","40","50","90","99","99","100","30","60","90"],nextabacab=function(){return++abacabindex>abacab.length-1&&(abacabindex=0),abacab[abacabindex]},abacabmode=!1,everabacab=!1,toggleabacab=function(){if(everabacab){var e=[],t=randint(3,15);for(let s=0;s<t;s++)e.push(randint(30,100));abacab=e}else abacab=["70","30","60","40","50","90","99","99","100","30","60","90"],everabacab=!0;var s=document.querySelectorAll("a.box.new-block:not(.person)")[0];s&&(abacabmode=!abacabmode,s.classList.toggle("toggle"))},playing=!1;function phase(){document.body.insertAdjacentHTML("afterbegin","\n    <style>\n      body.dim a {\n        filter: brightness(30%)\n      }\n      body.dim #filters {\n        filter:brightness(30%)!important\n      }\n      body.xdim a, body.xdim #filters {\n        filter: brightness(0%)\n      }\n      body.xdim div#filters {\n        filter: brightness(0%)!important;\n      }\n      * {\n        user-select:none!important\n      }\n      a {\n        color:black\n      }\n      a:active {\n        color:black\n      }\n      a.lit {\n        animation: .4s roggle infinite linear!important\n      }\n      .jit {\n        animation: .4s roggle infinite linear!important\n      }\n      .jjit {\n        animation: .8s rroggle infinite linear!important\n      }\n      a.hit {\n        filter:brightness(100%) hue-rotate(180deg)!important\n      }\n      a.toggle {\n        animation: .1s toggle infinite linear\n      }\n      a.lit.toggle {\n        animation:none\n      }\n      a.paintbrush {\n        background:lime\n      }\n      a.sloppy {\n        background:cyan;filter:brightness(70%)!important\n      }\n      a.painting {\n        background:lime;filter:brightness(100%)!important\n      }\n      a.moggle {\n        animation: .4s moggle infinite linear;\n      }\n      a.foggle {\n        animation: .4s moggle infinite linear;\n      }\n\n      div.filter {\n        pointer-events:none!important\n      }\n      a.lit.person:nth-of-type(6) {\n        filter:hue-rotate(180deg)\n      }\n      @keyframes toggle {\n        0% {filter:brightness(100%)}\n        50% {filter:brightness(100%)}\n        51% {filter:brightness(50%)}\n        100% {filter:brightness(50%)}\n      }    \n      @keyframes moggle {\n        0% {filter:brightness(100%) hue-rotate(0deg)}\n        50% {filter:brightness(100%) hue-rotate(0deg)}\n        51% {filter:brightness(50%) hue-rotate(180deg)}\n        100% {filter:brightness(50%) hue-rotate(180deg)}\n      }    \n      @keyframes roggle {\n        0% {filter:brightness(100%)}\n        50% {filter:brightness(100%)}\n        51% {filter:brightness(20%)}\n        100% {filter:brightness(20%)}\n      }    \n      @keyframes rroggle {\n        0% {filter:brightness(100%)}\n        10% {filter:brightness(100%)}\n        15% {filter:brightness(20%)}\n        100% {filter:brightness(20%)}\n      }    \n      \n    </style>\n  "),document.querySelectorAll("nav a.box")[0].style.backgroundColor="lime",setTimeout(()=>{document.querySelectorAll("nav a.box")[0].classList.add("jjit")},1e3),document.querySelectorAll("nav a.box")[0].addEventListener("click",()=>{playing?playing&&(document.querySelectorAll("nav a.box")[0].classList.add("jjit"),document.querySelectorAll("nav a.box")[0].style.backgroundColor="lime",playing=!1,ne()):(document.querySelectorAll("nav a.box")[0].classList.remove("jjit"),document.querySelectorAll("nav a.box")[0].style.backgroundColor="#090",playing=!0,ne())}),document.body.classList.add("grim"),document.body.classList.add("dim"),document.body.parentElement.style.background="#414141";var e=document.querySelectorAll("a.person");for(let t=0;t<e.length;t++)e[t].style.backgroundColor=`hsl(${randint(0,360)}, ${randint(30,100)}%, ${randint(45,75)}%)`,e[t].dataset.note=t;var t=document.querySelectorAll("a");for(let e=0;e<t.length;e++)t[e].href="#";var s=!1,n=0,a=(e=document.querySelectorAll("a.box.person")).length,i=new Set,r=!1,o=!1,d=!1,l=-1+n,h=!1,v=!1,w=!1,c=!1,u=!1,g=1;document.addEventListener("click",e=>{var t=e.target;if("a"===t.tagName.toLowerCase()&&t.classList.contains("person")){var n=Number(t.dataset.note);if(n===a-1)return!1===k?k=1:1===k&&(k=!1),void t.classList.toggle("moggle");if(n===a-2)return _(),void t.classList.toggle("foggle");0===n&&i.has(1)&&(!1===S?S=1:1===S?S=2:2===S&&(T=x,S=!1)),t.classList.contains("stas")||0!==n?t.classList.contains("stas")&&0===n&&(t.classList.remove("stas"),u=!0,P()):t.classList.add("stas"),t.classList.contains("stas")||1!==n?t.classList.contains("stas")&&1===n&&(t.classList.remove("stas"),c=!0,E()):t.classList.add("stas"),t.classList.contains("toggle")?(n===l&&(u?V=!0:(u=!0,P())),n===l&&w&&(w=!1,c=!0,E()),i.delete(n)):i.add(n),i.size===a-2&&(i.clear(),function(){if(d)return;d=!0,document.body.classList.add("xdim"),document.body.parentElement.style.background="#000";var e=document.querySelectorAll(".person");for(let t=0;t<e.length;t++)document.querySelectorAll(".person")[t].classList.remove("toggle"),document.querySelectorAll(".person")[t].style.background="red";synth.setReverbLev(.6),q=25,x=25,setTimeout(()=>{o=!0,r=!0},1e3)}(),t.classList.toggle("toggle")),i.size>5&&!s&&(s=!0,document.querySelectorAll(".person")[document.querySelectorAll(".person").length-2].classList.add("foggle"),_()),b=i.size>6?2:i.size>3&&1,t.classList.toggle("toggle")}var h=document.querySelectorAll(".box.small.new-block:not(.person)")[4];h&&h.addEventListener("click",B);var v=document.querySelectorAll(".box.small.new-block:not(.person)")[5];v&&v.addEventListener("click",M)});var m={a:60,b:5},f=2,p=5,b=!1;function y(e,t){return Math.random()*(t-e)+e}var q=90,x=q,T=x,A=!1,S=!1,k=!1,C=!1,L=0;function M(){x<10||(x-=2)}function B(){x>170||(x+=2)}var V=!1,R=!1;function P(){u&&(V=!V)}function E(){c&&(!1===R?R=1:1===R?R=2:2===R?R=3:3===R&&(R=!1))}function _(){s=!0,A=!A}!function(e){"use strict";function t(t){Object.assign(t,{properties:{masterVol:{type:Number,value:.5,observer:"setMasterVol"},reverbLev:{type:Number,value:.3,observer:"setReverbLev"},quality:{type:Number,value:1,observer:"setQuality"},debug:{type:Number,value:0},src:{type:String,value:null,observer:"loadMIDIfromSrc"},loop:{type:Number,value:0},internalcontext:{type:Number,value:1},tsmode:{type:Number,value:0},voices:{type:Number,value:64},useReverb:{type:Number,value:1}},program:[{name:"Acoustic Grand Piano"},{name:"Bright Acoustic Piano"},{name:"Electric Grand Piano"},{name:"Honky-tonk Piano"},{name:"Electric Piano 1"},{name:"Electric Piano 2"},{name:"Harpsichord"},{name:"Clavi"},{name:"Celesta"},{name:"Glockenspiel"},{name:"Music Box"},{name:"Vibraphone"},{name:"Marimba"},{name:"Xylophone"},{name:"Tubular Bells"},{name:"Dulcimer"},{name:"Drawbar Organ"},{name:"Percussive Organ"},{name:"Rock Organ"},{name:"Church Organ"},{name:"Reed Organ"},{name:"Accordion"},{name:"Harmonica"},{name:"Tango Accordion"},{name:"Acoustic Guitar (nylon)"},{name:"Acoustic Guitar (steel)"},{name:"Electric Guitar (jazz)"},{name:"Electric Guitar (clean)"},{name:"Electric Guitar (muted)"},{name:"Overdriven Guitar"},{name:"Distortion Guitar"},{name:"Guitar harmonics"},{name:"Acoustic Bass"},{name:"Electric Bass (finger)"},{name:"Electric Bass (pick)"},{name:"Fretless Bass"},{name:"Slap Bass 1"},{name:"Slap Bass 2"},{name:"Synth Bass 1"},{name:"Synth Bass 2"},{name:"Violin"},{name:"Viola"},{name:"Cello"},{name:"Contrabass"},{name:"Tremolo Strings"},{name:"Pizzicato Strings"},{name:"Orchestral Harp"},{name:"Timpani"},{name:"String Ensemble 1"},{name:"String Ensemble 2"},{name:"SynthStrings 1"},{name:"SynthStrings 2"},{name:"Choir Aahs"},{name:"Voice Oohs"},{name:"Synth Voice"},{name:"Orchestra Hit"},{name:"Trumpet"},{name:"Trombone"},{name:"Tuba"},{name:"Muted Trumpet"},{name:"French Horn"},{name:"Brass Section"},{name:"SynthBrass 1"},{name:"SynthBrass 2"},{name:"Soprano Sax"},{name:"Alto Sax"},{name:"Tenor Sax"},{name:"Baritone Sax"},{name:"Oboe"},{name:"English Horn"},{name:"Bassoon"},{name:"Clarinet"},{name:"Piccolo"},{name:"Flute"},{name:"Recorder"},{name:"Pan Flute"},{name:"Blown Bottle"},{name:"Shakuhachi"},{name:"Whistle"},{name:"Ocarina"},{name:"Lead 1 (square)"},{name:"Lead 2 (sawtooth)"},{name:"Lead 3 (calliope)"},{name:"Lead 4 (chiff)"},{name:"Lead 5 (charang)"},{name:"Lead 6 (voice)"},{name:"Lead 7 (fifths)"},{name:"Lead 8 (bass + lead)"},{name:"Pad 1 (new age)"},{name:"Pad 2 (warm)"},{name:"Pad 3 (polysynth)"},{name:"Pad 4 (choir)"},{name:"Pad 5 (bowed)"},{name:"Pad 6 (metallic)"},{name:"Pad 7 (halo)"},{name:"Pad 8 (sweep)"},{name:"FX 1 (rain)"},{name:"FX 2 (soundtrack)"},{name:"FX 3 (crystal)"},{name:"FX 4 (atmosphere)"},{name:"FX 5 (brightness)"},{name:"FX 6 (goblins)"},{name:"FX 7 (echoes)"},{name:"FX 8 (sci-fi)"},{name:"Sitar"},{name:"Banjo"},{name:"Shamisen"},{name:"Koto"},{name:"Kalimba"},{name:"Bag pipe"},{name:"Fiddle"},{name:"Shanai"},{name:"Tinkle Bell"},{name:"Agogo"},{name:"Steel Drums"},{name:"Woodblock"},{name:"Taiko Drum"},{name:"Melodic Tom"},{name:"Synth Drum"},{name:"Reverse Cymbal"},{name:"Guitar Fret Noise"},{name:"Breath Noise"},{name:"Seashore"},{name:"Bird Tweet"},{name:"Telephone Ring"},{name:"Helicopter"},{name:"Applause"},{name:"Gunshot"}],drummap:[{name:"Acoustic Bass Drum"},{name:"Bass Drum 1"},{name:"Side Stick"},{name:"Acoustic Snare"},{name:"Hand Clap"},{name:"Electric Snare"},{name:"Low Floor Tom"},{name:"Closed Hi Hat"},{name:"High Floor Tom"},{name:"Pedal Hi-Hat"},{name:"Low Tom"},{name:"Open Hi-Hat"},{name:"Low-Mid Tom"},{name:"Hi-Mid Tom"},{name:"Crash Cymbal 1"},{name:"High Tom"},{name:"Ride Cymbal 1"},{name:"Chinese Cymbal"},{name:"Ride Bell"},{name:"Tambourine"},{name:"Splash Cymbal"},{name:"Cowbell"},{name:"Crash Cymbal 2"},{name:"Vibraslap"},{name:"Ride Cymbal 2"},{name:"Hi Bongo"},{name:"Low Bongo"},{name:"Mute Hi Conga"},{name:"Open Hi Conga"},{name:"Low Conga"},{name:"High Timbale"},{name:"Low Timbale"},{name:"High Agogo"},{name:"Low Agogo"},{name:"Cabasa"},{name:"Maracas"},{name:"Short Whistle"},{name:"Long Whistle"},{name:"Short Guiro"},{name:"Long Guiro"},{name:"Claves"},{name:"Hi Wood Block"},{name:"Low Wood Block"},{name:"Mute Cuica"},{name:"Open Cuica"},{name:"Mute Triangle"},{name:"Open Triangle"}],program1:[[{w:"sine",v:.4,d:.7,r:.1},{w:"triangle",v:3,d:.7,s:.1,g:1,k:-1.2}],[{w:"triangle",v:.4,d:.7,r:.1},{w:"triangle",v:4,t:3,d:.4,s:.1,g:1,k:-1}],[{w:"sine",d:.7,r:.1},{w:"triangle",v:4,f:2,d:.5,s:.5,g:1,k:-1}],[{w:"sine",d:.7,v:.2},{w:"triangle",v:4,t:3,f:2,d:.3,g:1,k:-1,s:.5}],[{w:"sine",v:.35,d:.7},{w:"sine",v:3,t:7,f:1,d:1,s:1,g:1,k:-.7}],[{w:"sine",v:.35,d:.7},{w:"sine",v:8,t:7,f:1,d:.5,s:1,g:1,k:-.7}],[{w:"sawtooth",v:.34,d:2},{w:"sine",v:8,f:.1,d:2,s:1,r:2,g:1}],[{w:"triangle",v:.34,d:1.5},{w:"square",v:6,f:.1,d:1.5,s:.5,r:2,g:1}],[{w:"sine",v:.3,d:.3,r:.3},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",v:.3,d:.3,r:.3},{w:"sine",v:11,t:6,d:.2,s:.4,g:1}],[{w:"sine",v:.2,d:.3,r:.3},{w:"sine",v:11,t:5,d:.1,s:.4,g:1}],[{w:"sine",v:.2,d:.6,r:.6},{w:"triangle",v:11,t:5,f:1,s:.5,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:6,t:5,d:.02,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",v:.2,d:1,r:1},{w:"sine",v:11,t:3.5,d:1,r:1,g:1}],[{w:"triangle",v:.2,d:.5,r:.2},{w:"sine",v:6,t:2.5,d:.2,s:.1,r:.2,g:1}],[{w:"w9999",v:.22,s:.9},{w:"w9999",v:.22,t:2,f:2,s:.9}],[{w:"w9999",v:.2,s:1},{w:"sine",v:11,t:6,f:2,s:.1,g:1,h:.006,r:.002,d:.002},{w:"w9999",v:.2,t:2,f:1,h:0,s:1}],[{w:"w9999",v:.2,d:.1,s:.9},{w:"w9999",v:.25,t:4,f:2,s:.5}],[{w:"w9999",v:.3,s:.9},{w:"w9999",v:.2,t:8,f:2,s:.9}],[{w:"sine",v:.2,d:.05,s:1},{w:"sine",v:6,t:3,f:1,d:.05,s:1,g:1}],[{w:"triangle",v:.2,d:.05,s:.8},{w:"square",v:7,t:3,f:1,d:.05,s:1.5,g:1}],[{w:"square",v:.2,d:.2,s:.5},{w:"square",v:1,d:.03,s:2,g:1}],[{w:"square",v:.2,d:.1,s:.8},{w:"square",v:1,d:.1,s:2,g:1}],[{w:"sine",v:.3,d:.5,f:1},{w:"triangle",v:5,t:3,f:-1,d:1,s:.1,g:1}],[{w:"sine",v:.4,d:.6,f:1},{w:"triangle",v:12,t:3,d:.6,s:.1,g:1,f:-1}],[{w:"triangle",v:.3,d:1,f:1},{w:"triangle",v:6,f:-1,d:.4,s:.5,g:1,t:3}],[{w:"sine",v:.3,d:1,f:-1},{w:"triangle",v:11,f:1,d:.4,s:.5,g:1,t:3}],[{w:"sine",v:.4,d:.1,r:.01},{w:"sine",v:7,g:1}],[{w:"triangle",v:.4,d:1,f:1},{w:"square",v:4,f:-1,d:1,s:.7,g:1}],[{w:"triangle",v:.35,d:1,f:1},{w:"square",v:7,f:-1,d:.3,s:.5,g:1}],[{w:"sine",v:.2,t:1.5,h:.2,d:.6},{w:"sine",v:11,t:5,f:2,d:1,s:.5,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"w9999",d:.3,v:.7,s:.5},{w:"sawtooth",v:1.2,d:.02,s:.5,g:1,h:0,r:.02}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"sawtooth",v:.4,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sine",v:.4,d:11},{w:"sine",v:6,f:2.5,d:.05,s:1.1,g:1}],[{w:"sine",v:.3,d:.1,r:.1},{w:"square",v:4,t:3,d:1,s:.2,g:1}],[{w:"sine",v:.3,d:.5,r:.5},{w:"sine",v:7,t:2,f:2,d:1,r:1,g:1}],[{w:"triangle",v:.6,h:.03,d:.3,r:.3,t:.5},{w:"n0",v:8,t:1.5,d:.08,r:.08,g:1}],[{w:"sawtooth",v:.3,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.3,f:-2,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.2,s:1},{w:"sawtooth",v:.2,t:2,f:2,a:1,d:1,s:1}],[{w:"sawtooth",v:.2,s:1},{w:"sawtooth",v:.2,f:2,a:.02,d:1,s:1}],[{w:"triangle",v:.3,s:1},{w:"sine",v:3,t:5,f:1,d:1,s:1,g:1}],[{w:"sine",v:.4,s:.9},{w:"sine",v:1,t:2,f:3,d:.03,s:.2,g:1}],[{w:"triangle",v:.6,s:.5},{w:"sine",v:1,f:.8,d:.2,s:.2,g:1}],[{w:"square",v:.15,d:.2,r:.2,t:.5,h:.03},{w:"square",v:4,f:.5,d:.2,r:11,g:1,h:.02},{w:"square",v:.15,t:4,f:1,d:.15,r:.15,h:.03},{g:3,w:"square",v:4,f:-.5,h:.02,d:.15,r:11}],[{w:"square",v:.2,d:1,s:.6,r:.04},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,d:1,s:.4,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.15,s:1},{w:"sine",v:2,d:.1,g:1}],[{w:"square",v:.2,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,d:1,s:.6,r:.08},{w:"sine",v:1,f:.2,d:.1,s:4,g:1}],[{w:"square",v:.2,d:.5,s:.7,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"sine",v:.4,d:.7,s:.5},{w:"square",v:5,t:2,d:.2,s:.5,g:1}],[{w:"sine",v:.3,d:.2,s:.8},{w:"sawtooth",v:6,f:.1,d:.1,s:.3,g:1}],[{w:"sine",v:.3,d:.2,s:.4},{w:"square",v:7,f:.2,d:1,s:.1,g:1}],[{w:"square",v:.2,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",a:.02,d:2},{w:"sine",v:6,t:2,d:.04,g:1}],[{w:"sine",v:.7,d:.4,s:.4},{w:"sine",v:4,t:2,f:.2,d:.4,g:1}],[{w:"sine",v:.7,d:.4,s:.6},{w:"sine",v:3,t:2,d:0,s:1,g:1}],[{w:"sine",v:.4,a:.06,d:.3,s:.3},{w:"sine",v:7,t:2,d:.2,s:.2,g:1}],[{w:"sine",a:.02,d:.3,s:.3},{w:"sawtooth",v:3,t:2,d:.3,g:1}],[{w:"sine",v:.4,d:2,s:.1},{w:"sawtooth",v:8,t:2,f:1,d:.5,g:1}],[{w:"sine",v:.7,d:.5,s:.3},{w:"sine",v:.003,t:0,f:4,d:.1,s:.002,g:1}],[{w:"sine",v:.7,d:2},{w:"sine",v:1,t:2,f:1,d:.02,g:1}],[{w:"square",v:.3,d:1,s:.5},{w:"square",v:1,f:.2,d:1,s:.5,g:1}],[{w:"sawtooth",v:.3,d:2,s:.5},{w:"square",v:2,f:.1,s:.5,g:1}],[{w:"triangle",v:.5,d:2,s:.6},{w:"sine",v:4,t:2,g:1}],[{w:"triangle",v:.3,d:2,s:.3},{w:"sine",v:22,t:2,f:1,d:.03,s:.2,g:1}],[{w:"sawtooth",v:.3,d:1,s:.5},{w:"sine",v:11,t:11,a:.2,d:.05,s:.3,g:1}],[{w:"sine",v:.3,a:.06,d:1,s:.5},{w:"sine",v:7,f:1,d:1,s:.2,g:1}],[{w:"sawtooth",v:.3,d:.7,s:.3,r:.2},{w:"sawtooth",v:.3,t:.75,d:.7,s:.3,r:.2}],[{w:"triangle",v:.3,d:.7,s:.5},{w:"square",v:5,t:.5,d:.7,s:.5,g:1}],[{w:"triangle",v:.3,d:.3,s:.3,r:.3},{w:"square",v:3,t:4,f:1,d:.1,s:1,g:1},{w:"triangle",v:.08,t:.5,h:0,d:.1,s:.5,r:.1,b:0,c:0}],[{w:"sine",v:.3,a:.05,d:1,s:.7,r:.3},{w:"sine",v:2,f:1,d:.3,s:1,g:1}],[{w:"square",v:.3,a:.03,d:.5,s:.3,r:.1},{w:"square",v:4,f:1,a:.03,d:.1,g:1}],[{w:"triangle",v:.3,a:.08,d:1,s:.3,r:.1},{w:"square",v:2,f:1,d:.3,s:.3,g:1,t:4,a:.08}],[{w:"sine",v:.3,d:1,s:.3,r:.1},{w:"sine",v:.1,t:2.001,f:1,d:1,s:50,g:1}],[{w:"triangle",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sine",v:12,t:7,f:1,d:.5,s:1.7,g:1}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sawtooth",v:22,t:6,d:.06,s:.3,g:1}],[{w:"triangle",v:.3,a:.05,d:11,r:.3},{w:"triangle",v:1,d:1,s:8,g:1}],[{w:"sawtooth",v:.3,d:4,s:.8,r:.1},{w:"square",v:1,t:2,f:8,a:1,d:1,s:1,r:.1,g:1}],[{w:"triangle",v:.3,d:1,s:.5,t:.8,a:.2,p:1.25,q:.2},{w:"sawtooth",v:.2,a:.2,d:.3,s:1,t:1.2,p:1.25,q:.2}],[{w:"sine",v:.3,d:1,s:.3},{w:"square",v:22,t:11,d:.5,s:.1,g:1}],[{w:"sawtooth",v:.3,a:.04,d:1,s:.8,r:.1},{w:"square",v:1,t:.5,d:1,s:2,g:1}],[{w:"triangle",v:.3,d:1,s:.3},{w:"sine",v:22,t:6,d:.6,s:.05,g:1}],[{w:"sine",v:.6,a:.1,d:.05,s:.4},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"sine",a:.1,d:.05,s:.4,v:.8},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"square",v:.3,a:.1,d:.1,s:.4},{w:"square",v:1,f:1,d:.3,s:.1,g:1}],[{w:"sawtooth",v:.3,d:.5,r:.5},{w:"sawtooth",v:11,t:5,d:.05,g:1}],[{w:"square",v:.3,d:.2,r:.2},{w:"square",v:7,t:3,d:.05,g:1}],[{w:"triangle",d:.2,r:.2},{w:"square",v:9,t:3,d:.1,r:.1,g:1}],[{w:"triangle",d:.3,r:.3},{w:"square",v:6,t:3,d:1,r:1,g:1}],[{w:"triangle",v:.4,d:.2,r:.2},{w:"square",v:22,t:12,d:.1,r:.1,g:1}],[{w:"sine",v:.25,a:.02,d:.05,s:.8},{w:"square",v:1,t:2,d:.03,s:11,g:1}],[{w:"sine",v:.3,a:.05,d:11},{w:"square",v:7,t:3,f:1,s:.7,g:1}],[{w:"square",v:.3,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",v:.4,d:.3,r:.3},{w:"sine",v:7,t:9,d:.1,r:.1,g:1}],[{w:"sine",v:.7,d:.1,r:.1},{w:"sine",v:22,t:7,d:.05,g:1}],[{w:"sine",v:.6,d:.15,r:.15},{w:"square",v:11,t:3.2,d:.1,r:.1,g:1}],[{w:"sine",v:.5,d:.07,r:.07},{w:"square",v:11,t:7,r:.01,g:1}],[{w:"triangle",v:.7,t:.5,d:.2,r:.2,p:.95},{w:"n0",v:9,g:1,d:.2,r:.2}],[{w:"sine",v:.7,d:.1,r:.1,p:.9},{w:"square",v:14,t:2,d:.005,r:.005,g:1}],[{w:"square",d:.15,r:.15,p:.5},{w:"square",v:4,t:5,d:.001,r:.001,g:1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"sine",t:12.5,d:0,r:0,p:.5,v:.3,h:.2,q:.5},{g:1,w:"sine",v:1,t:2,d:0,r:0,s:1},{g:1,w:"n0",v:.2,t:2,a:.6,h:0,d:.1,r:.1,b:0,c:0}],[{w:"n0",v:.2,a:.05,h:.02,d:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.1,d:1,s:.5},{w:"sine",v:4,t:0,f:1.5,d:1,s:1,r:.1,g:1},{g:1,w:"sine",v:4,t:0,f:2,a:.6,h:0,d:.1,s:1,r:.1,b:0,c:0}],[{w:"square",v:.3,t:.25,d:11,s:1},{w:"square",v:12,t:0,f:8,d:1,s:1,r:11,g:1}],[{w:"n0",v:.4,t:.5,d:11,s:1,r:.5},{w:"square",v:1,t:0,f:14,d:1,s:1,r:11,g:1}],[{w:"sine",t:0,f:1221,d:1,r:.25,s:1},{g:1,w:"n0",v:3,t:.5,d:1,s:1,r:1}],[{w:"sine",d:.4,r:.4,p:.1,t:2.5,v:1},{w:"n0",v:12,t:2,d:1,r:1,g:1}]],program0:[[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sine",v:.5,d:.3,r:.3}],[{w:"triangle",v:.5,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"square",v:.2,d:1,r:1}],[{w:"sawtooth",v:.3,d:.7,r:.7}],[{w:"sine",v:.5,a:.01,s:1}],[{w:"sine",v:.7,d:.02,s:.7}],[{w:"square",v:.2,s:1}],[{w:"triangle",v:.5,a:.01,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.05,s:1}],[{w:"triangle",v:.5,d:.5}],[{w:"square",v:.2,d:.6}],[{w:"square",v:.2,d:.6}],[{w:"triangle",v:.8,d:.6}],[{w:"triangle",v:.4,d:.05}],[{w:"square",v:.2,d:1}],[{w:"square",v:.2,d:1}],[{w:"sine",v:.4,d:.6}],[{w:"triangle",v:.7,d:.4}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.1,s:.2}],[{w:"sawtooth",v:.4,d:.1,s:.2}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.3,d:.1}],[{w:"sawtooth",v:.3,d:.5,r:.5}],[{w:"triangle",v:.6,d:.1,r:.1,h:.03,p:.8}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,s:1}],[{w:"triangle",v:.3,a:.03,s:1}],[{w:"sine",v:.3,a:.03,s:1}],[{w:"triangle",v:.3,a:.05,s:1}],[{w:"sawtooth",v:.5,a:.01,d:.1}],[{w:"square",v:.3,d:.2,s:.6}],[{w:"square",v:.3,d:.2,s:.6}],[{w:"square",v:.3,d:.2,s:.6}],[{w:"square",v:.2,d:.01,s:1}],[{w:"square",v:.3,s:1}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,d:2}],[{w:"square",v:.3,a:.04,d:2}],[{w:"square",v:.3,d:2}],[{w:"square",v:.3,a:.05,d:2}],[{w:"square",v:.3,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"sine",v:.7,d:2}],[{w:"sine",v:.7,d:2}],[{w:"sine",v:.7,d:2}],[{w:"sine",v:.7,d:2}],[{w:"sine",v:.7,d:2}],[{w:"sine",v:.7,d:2}],[{w:"sine",v:.7,d:2}],[{w:"sine",v:.7,d:2}],[{w:"square",v:.3,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"triangle",v:.5,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"sawtooth",v:.4,d:12}],[{w:"sine",v:.4,a:.06,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.3,d:12}],[{w:"triangle",v:.5,d:12}],[{w:"square",v:.3,d:12}],[{w:"triangle",v:.5,a:.08,d:11}],[{w:"sawtooth",v:.5,a:.05,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.5,a:.04,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,a:.8,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.3,d:1,r:1}],[{w:"sawtooth",v:.5,d:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"square",v:.3,d:.2,r:.2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"sawtooth",v:.2,a:.02,d:.7}],[{w:"triangle",v:.5,d:1}],[{w:"sawtooth",v:.3,d:.3,r:.3}],[{w:"sine",v:.8,d:.1,r:.1}],[{w:"square",v:.2,d:.1,r:.1,p:1.05}],[{w:"sine",v:.8,d:.05,r:.05}],[{w:"triangle",v:.5,d:.1,r:.1,p:.96}],[{w:"triangle",v:.5,d:.1,r:.1,p:.97}],[{w:"square",v:.3,d:.1,r:.1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"triangle",v:.5,d:.03,t:0,f:1332,r:.001,p:1.1}],[{w:"n0",v:.2,t:.1,d:.02,a:.05,h:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.8,d:1,t:0,f:1832}],[{w:"triangle",d:.5,t:0,f:444,s:1}],[{w:"n0",v:.4,d:1,t:0,f:22,s:1}],[{w:"n0",v:.5,a:.2,d:11,t:0,f:44}],[{w:"n0",v:.5,t:.25,d:.4,r:.4}]],drummap1:[[{w:"triangle",t:0,f:70,v:1,d:.05,h:.03,p:.9,q:.1},{w:"n0",g:1,t:6,v:17,r:.01,h:0,p:0}],[{w:"triangle",t:0,f:88,v:1,d:.05,h:.03,p:.5,q:.1},{w:"n0",g:1,t:5,v:42,r:.01,h:0,p:0}],[{w:"n0",f:222,p:0,t:0,r:.01,h:0}],[{w:"triangle",v:.3,f:180,d:.05,t:0,h:.03,p:.9,q:.1},{w:"n0",v:.6,t:0,f:70,h:.02,r:.01,p:0},{g:1,w:"square",v:2,t:0,f:360,r:.01,b:0,c:0}],[{w:"square",f:1150,v:.34,t:0,r:.03,h:.025,d:.03},{g:1,w:"n0",t:0,f:13,h:.025,d:.1,s:1,r:.1,v:1}],[{w:"triangle",f:200,v:1,d:.06,t:0,r:.06},{w:"n0",g:1,t:0,f:400,v:12,r:.02,d:.02}],[{w:"triangle",f:100,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.4,h:.015,d:.005,r:.005}],[{w:"n1",f:390,v:.25,r:.01,t:0}],[{w:"triangle",f:120,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.5,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,r:.03,t:0,h:.005,d:.03}],[{w:"triangle",f:140,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,t:0,d:.2,r:.2},{w:"n0",v:.3,t:0,c:0,f:440,h:.005,d:.05}],[{w:"triangle",f:155,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"triangle",f:180,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],[{w:"triangle",f:220,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",f:500,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.1,t:0,r:.01,f:440}],[{w:"n1",v:.3,f:800,d:.2,r:.2,h:.05,t:0},{w:"square",t:0,v:1,d:.1,r:.1,p:.1,f:220,g:1}],[{w:"sine",f:1651,v:.15,d:.2,r:.2,h:0,t:0},{w:"sawtooth",g:1,t:1.21,v:7.2,d:.1,r:11,h:1},{g:1,w:"n0",v:3.1,t:.152,d:.002,r:.002}],null,[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],null,[{w:"n1",v:.3,f:555,d:.25,r:.25,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,f:440,a:.005,h:.02}],[{w:"sawtooth",f:776,v:.2,d:.3,t:0,r:.3},{g:1,w:"n0",v:2,t:0,f:776,a:.005,h:.02,d:.1,s:1,r:.1,c:0},{g:11,w:"sine",v:.1,t:0,f:22,d:.3,r:.3,b:0,c:0}],[{w:"n1",f:440,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.4,t:0,r:.01,f:440}],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[{w:"sine",f:1720,v:.3,d:.02,t:0,r:.02},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}],[{w:"sine",f:1720,v:.3,d:.25,t:0,r:.25},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}]],drummap0:[[{w:"triangle",t:0,f:110,v:1,d:.05,h:.02,p:.1}],[{w:"triangle",t:0,f:150,v:.8,d:.1,p:.1,h:.02,r:.01}],[{w:"n0",f:392,v:.5,d:.01,p:0,t:0,r:.05}],[{w:"n0",f:33,d:.05,t:0}],[{w:"n0",f:100,v:.7,d:.03,t:0,r:.03,h:.02}],[{w:"n0",f:44,v:.7,d:.02,p:.1,t:0,h:.02}],[{w:"triangle",f:240,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,r:.01,t:0}],[{w:"triangle",f:270,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.04,r:.04,t:0}],[{w:"triangle",f:300,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.1,r:.1,h:.02,t:0}],[{w:"triangle",f:320,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"triangle",f:360,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.1,h:.05,t:0,p:.1}],[{w:"triangle",f:400,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:440,v:.3,d:.1,p:.9,t:0,r:.1}],[{w:"n0",f:200,v:.2,d:.05,p:.9,t:0}],[{w:"n0",f:440,v:.3,d:.12,p:.9,t:0}],[{w:"sine",f:800,v:.4,d:.06,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:33,v:.3,d:.2,p:.9,t:0}],[{w:"n0",f:300,v:.3,d:.14,p:.9,t:0}],[{w:"sine",f:200,d:.06,t:0}],[{w:"sine",f:150,d:.06,t:0}],[{w:"sine",f:300,t:0}],[{w:"sine",f:300,d:.06,t:0}],[{w:"sine",f:250,d:.06,t:0}],[{w:"square",f:300,v:.3,d:.06,p:.8,t:0}],[{w:"square",f:260,v:.3,d:.06,p:.8,t:0}],[{w:"sine",f:850,v:.5,d:.07,t:0}],[{w:"sine",f:790,v:.5,d:.07,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"triangle",f:1800,v:.4,p:.9,t:0,h:.03}],[{w:"triangle",f:1800,v:.3,p:.9,t:0,h:.13}],[{w:"n0",f:330,v:.3,a:.02,t:0,r:.01}],[{w:"n0",f:330,v:.3,a:.02,t:0,h:.04,r:.01}],[{w:"n0",f:440,v:.3,t:0}],[{w:"sine",f:800,t:0}],[{w:"sine",f:700,t:0}],[{w:"n0",f:330,v:.3,t:0}],[{w:"n0",f:330,v:.3,t:0,h:.1,r:.01,p:.7}],[{w:"sine",t:0,f:1200,v:.3,r:.01}],[{w:"sine",t:0,f:1200,v:.3,d:.2,r:.2}]],ready:()=>new Promise(e=>{const t=setInterval(()=>{this.isReady&&(clearInterval(t),console.log("Initialized"),e())},100)}),init:()=>{this.pg=[],this.vol=[],this.ex=[],this.bend=[],this.rpnidx=[],this.brange=[],this.sustain=[],this.notetab=[],this.rhythm=[],this.maxTick=0,this.playTick=0,this.playing=0,this.releaseRatio=3.5;for(let e=0;e<16;++e)this.pg[e]=0,this.vol[e]=3e4/16129,this.bend[e]=0,this.brange[e]=256,this.rhythm[e]=0;this.rhythm[9]=1,this.preroll=.2,this.relcnt=0,setInterval(function(){if(++this.relcnt>=3){this.relcnt=0;for(let t=this.notetab.length-1;t>=0;--t){var e=this.notetab[t];this.actx.currentTime>e.e&&(this._pruneNote(e),this.notetab.splice(t,1))}}}.bind(this),60),console.log("internalcontext:"+this.internalcontext),this.internalcontext&&(e.AudioContext=e.AudioContext||e.webkitAudioContext,this.setAudioContext(new AudioContext)),this.isReady=1},setMasterVol:e=>{null!=e&&(this.masterVol=e),this.out&&(this.out.gain.value=this.masterVol)},setReverbLev:e=>{null!=e&&(this.reverbLev=e);var t=parseFloat(this.reverbLev);this.rev&&!isNaN(t)&&(this.rev.gain.value=8*t)},reset:()=>{for(let e=0;e<16;++e)this.setProgram(e,0),this.setBendRange(e,256),this.setModulation(e,0),this.setChVol(e,100),this.setPan(e,64),this.resetAllControllers(e),this.allSoundOff(e),this.rhythm[e]=0;this.rhythm[9]=1},setQuality:e=>{null!=e&&(this.quality=e);for(let e=0;e<128;++e)this.setTimbre(0,e,this.program0[e]);for(let e=0;e<this.drummap0.length;++e)this.setTimbre(1,e+35,this.drummap0[e]);if(this.quality){for(let e=0;e<this.program1.length;++e)this.setTimbre(0,e,this.program1[e]);for(let e=0;e<this.drummap.length;++e)this.drummap1[e]&&this.setTimbre(1,e+35,this.drummap1[e])}},setTimbre:(e,t,s)=>{const n={g:0,w:"sine",t:1,f:0,v:.5,a:0,h:.01,d:.01,s:0,r:.05,p:1,q:1,k:0};function a(e){for(t=0;t<e.length;++t)for(let s in n)e[t].hasOwnProperty(s)&&void 0!==e[t][s]||(e[t][s]=n[s]);return e}e&&t>=35&&t<=81&&(this.drummap[t-35].p=a(s)),0==e&&t>=0&&t<=127&&(this.program[t].p=a(s))},_pruneNote:e=>{for(let t=e.o.length-1;t>=0;--t){if(e.o[t].frequency?e.o[t].frequency.cancelScheduledValues(0):e.o[t].playbackRate.cancelScheduledValues(0),e.g[t].gain.cancelScheduledValues(0),e.o[t].stop(),e.o[t].detune)try{this.chmod[e.ch].disconnect(e.o[t].detune)}catch(e){}e.g[t].gain.value=0}},_limitVoices:(e,t)=>{this.notetab.sort(function(e,t){return e.f!=t.f?e.f-t.f:e.e!=t.e?t.e-e.e:t.t-e.t});for(let e=this.notetab.length-1;e>=0;--e){var s=this.notetab[e];(this.actx.currentTime>s.e||e>=this.voices-1)&&(this._pruneNote(s),this.notetab.splice(e,1))}},_note:(e,t,s,n,a)=>{let i,r,o;const d=[],l=[],h=[],v=[],w=[],c=440*Math.pow(2,(s-69)/12);this._limitVoices(t,s);for(let u=0;u<a.length;++u){const g=e+(o=a[u]).a+o.h;switch(0==o.g?(i=this.chvol[t],r=n*n/16384,v[u]=c*o.t+o.f):o.g>10?(i=l[o.g-11].gain,r=1,v[u]=v[o.g-11]*o.t+o.f):d[o.g-1].frequency?(i=d[o.g-1].frequency,r=v[o.g-1],v[u]=v[o.g-1]*o.t+o.f):(i=d[o.g-1].playbackRate,r=v[o.g-1]/440,v[u]=v[o.g-1]*o.t+o.f),o.w[0]){case"n":d[u]=this.actx.createBufferSource(),d[u].buffer=this.noiseBuf[o.w],d[u].loop=!0,d[u].playbackRate.value=v[u]/440,1!=o.p&&this._setParamTarget(d[u].playbackRate,v[u]/440*o.p,e,o.q),this.chmod[t].connect(d[u].detune),d[u].detune.value=this.bend[t];break;default:d[u]=this.actx.createOscillator(),d[u].frequency.value=v[u],1!=o.p&&this._setParamTarget(d[u].frequency,v[u]*o.p,e,o.q),"w"==o.w[0]?d[u].setPeriodicWave(this.wave[o.w]):d[u].type=o.w,this.chmod[t].connect(d[u].detune),d[u].detune.value=this.bend[t]}l[u]=this.actx.createGain(),w[u]=o.r,d[u].connect(l[u]),l[u].connect(i),h[u]=r*o.v,o.k&&(h[u]*=Math.pow(2,(s-60)/12*o.k)),o.a?(l[u].gain.value=0,l[u].gain.setValueAtTime(0,e),l[u].gain.linearRampToValueAtTime(h[u],e+o.a)):l[u].gain.setValueAtTime(h[u],e),this._setParamTarget(l[u].gain,o.s*h[u],g,o.d),d[u].start(e),this.rhythm[t]&&(d[u].onended=(()=>{this.chmod[t].disconnect(d[u].detune)}),d[u].stop(e+a[0].d*this.releaseRatio))}this.rhythm[t]||this.notetab.push({t:e,e:99999,ch:t,n:s,o:d,g:l,t2:e+o.a,v:h,r:w,f:0})},_setParamTarget:(e,t,s,n)=>{0!=n?e.setTargetAtTime(t,s,n):e.setValueAtTime(t,s)},_releaseNote:(e,t)=>{if(9!=e.ch)for(let s=e.g.length-1;s>=0;--s)e.g[s].gain.cancelScheduledValues(t),t==e.t2?e.g[s].gain.setValueAtTime(e.v[s],t):t<e.t2&&e.g[s].gain.setValueAtTime(e.v[s]*(t-e.t)/(e.t2-e.t),t),this._setParamTarget(e.g[s].gain,0,t,e.r[s]);e.e=t+e.r[0]*this.releaseRatio,e.f=1},setModulation:(e,t,s)=>{this.chmod[e].gain.setValueAtTime(100*t/127,this._tsConv(s))},setChVol:(e,t,s)=>{this.vol[e]=3*t*t/16129,this.chvol[e].gain.setValueAtTime(this.vol[e]*this.ex[e],this._tsConv(s))},setPan:(e,t,s)=>{this.chpan[e]&&this.chpan[e].pan.setValueAtTime((t-64)/64,this._tsConv(s))},setExpression:(e,t,s)=>{this.ex[e]=t*t/16129,this.chvol[e].gain.setValueAtTime(this.vol[e]*this.ex[e],this._tsConv(s))},setSustain:(e,t,s)=>{if(this.sustain[e]=t,s=this._tsConv(s),t<64)for(let t=this.notetab.length-1;t>=0;--t){const n=this.notetab[t];s>=n.t&&n.ch==e&&1==n.f&&this._releaseNote(n,s)}},allSoundOff:e=>{for(let t=this.notetab.length-1;t>=0;--t){const s=this.notetab[t];s.ch==e&&(this._pruneNote(s),this.notetab.splice(t,1))}},resetAllControllers:e=>{this.bend[e]=0,this.ex[e]=1,this.rpnidx[e]=16383,this.sustain[e]=0,this.chvol[e]&&(this.chvol[e].gain.value=this.vol[e]*this.ex[e],this.chmod[e].gain.value=0)},setBendRange:(e,t)=>{this.brange[e]=t},setProgram:(e,t)=>{this.debug&&console.log("Pg("+e+")="+t),this.pg[e]=t},_tsConv:e=>(null==e||e<=0?(e=0,this.actx&&(e=this.actx.currentTime)):this.tsmode&&(e=.001*e-this.tsdiff),e),setBend:(e,t,s)=>{s=this._tsConv(s);const n=100*this.brange[e]/127;this.bend[e]=(t-8192)*n/8192;for(let t=this.notetab.length-1;t>=0;--t){const n=this.notetab[t];if(n.ch==e)for(let t=n.o.length-1;t>=0;--t)n.o[t].frequency&&n.o[t].detune.setValueAtTime(this.bend[e],s)}},noteOff:(e,t,s)=>{if(!this.rhythm[e]){s=this._tsConv(s);for(let n=this.notetab.length-1;n>=0;--n){const a=this.notetab[n];s>=a.t&&a.ch==e&&a.n==t&&0==a.f&&(a.f=1,this.sustain[e]<64&&this._releaseNote(a,s))}}},noteOn:(e,t,s,n)=>{0!=s?(n=this._tsConv(n),this.rhythm[e]?t>=35&&t<=81&&this._note(n,e,t,s,this.drummap[t-35].p):this._note(n,e,t,s,this.program[this.pg[e]].p)):this.noteOff(e,t,n)},setTsMode:e=>{this.tsmode=e},send:(e,t)=>{const s=15&e[0],n=-16&e[0];if(!(n<128||n>=256))switch("suspended"==this.audioContext.state&&this.audioContext.resume(),n){case 176:switch(e[1]){case 1:this.setModulation(s,e[2],t);break;case 7:this.setChVol(s,e[2],t);break;case 10:this.setPan(s,e[2],t);break;case 11:this.setExpression(s,e[2],t);break;case 64:this.setSustain(s,e[2],t);break;case 98:case 98:this.rpnidx[s]=16383;break;case 100:this.rpnidx[s]=896&this.rpnidx[s]|e[2];break;case 101:this.rpnidx[s]=127&this.rpnidx[s]|e[2]<<7;break;case 6:0==this.rpnidx[s]&&(this.brange[s]=(e[2]<<7)+(127&this.brange[s]));break;case 38:0==this.rpnidx[s]&&(this.brange[s]=896&this.brange[s]|e[2]);break;case 120:case 123:case 124:case 125:case 126:case 127:this.allSoundOff(s);break;case 121:this.resetAllControllers(s)}break;case 192:this.setProgram(s,e[1]);break;case 224:this.setBend(s,e[1]+(e[2]<<7),t);break;case 144:this.noteOn(s,e[1],e[2],t);break;case 128:this.noteOff(s,e[1],t);break;case 240:if(255==e[0]){this.reset();break}if(254!=e[0]&&this.debug){var a=[];for(let t=0;t<e.length;++t)a.push(e[t].toString(16))}if(65==e[1]&&16==e[2]&&66==e[3]&&18==e[4]&&64==e[5]&&16==(240&e[6])&&21==e[7]){const t=[9,0,1,2,3,4,5,6,7,8,10,11,12,13,14,15][15&e[6]];this.rhythm[t]=e[8]}}},_createWave:e=>{const t=new Float32Array(e.length),s=new Float32Array(e.length);for(let s=1;s<e.length;++s)t[s]=e[s];return this.actx.createPeriodicWave(s,t)},getAudioContext:()=>this.actx,setAudioContext:(e,t)=>{this.audioContext=this.actx=e,this.dest=t,t||(this.dest=e.destination),this.tsdiff=.001*performance.now()-this.actx.currentTime,console.log("TSDiff:"+this.tsdiff),this.out=this.actx.createGain(),this.comp=this.actx.createDynamicsCompressor();var s=.5*this.actx.sampleRate|0;this.convBuf=this.actx.createBuffer(2,s,this.actx.sampleRate),this.noiseBuf={},this.noiseBuf.n0=this.actx.createBuffer(1,s,this.actx.sampleRate),this.noiseBuf.n1=this.actx.createBuffer(1,s,this.actx.sampleRate);var n=this.convBuf.getChannelData(0),a=this.convBuf.getChannelData(1),i=this.noiseBuf.n0.getChannelData(0),r=this.noiseBuf.n1.getChannelData(0);for(let e=0;e<s;++e)e/s<Math.random()&&(n[e]=Math.exp(-3*e/s)*(Math.random()-.5)*.5,a[e]=Math.exp(-3*e/s)*(Math.random()-.5)*.5),i[e]=2*Math.random()-1;for(let e=0;e<64;++e){const e=10*Math.random()+1,t=10*Math.random()+1;for(let n=0;n<s;++n){var o=Math.sin(n/s*2*Math.PI*440*e)*Math.sin(n/s*2*Math.PI*440*t);r[n]+=o/8}}this.useReverb&&(this.conv=this.actx.createConvolver(),this.conv.buffer=this.convBuf,this.rev=this.actx.createGain(),this.rev.gain.value=this.reverbLev,this.out.connect(this.conv),this.conv.connect(this.rev),this.rev.connect(this.comp)),this.setMasterVol(),this.out.connect(this.comp),this.comp.connect(this.dest),this.chvol=[],this.chmod=[],this.chpan=[],this.wave={w9999:this._createWave("w9999")},this.lfo=this.actx.createOscillator(),this.lfo.frequency.value=5,this.lfo.start(0);for(let e=0;e<16;++e)this.chvol[e]=this.actx.createGain(),this.actx.createStereoPanner?(this.chpan[e]=this.actx.createStereoPanner(),this.chvol[e].connect(this.chpan[e]),this.chpan[e].connect(this.out)):(this.chpan[e]=null,this.chvol[e].connect(this.out)),this.chmod[e]=this.actx.createGain(),this.lfo.connect(this.chmod[e]),this.pg[e]=0,this.resetAllControllers(e);this.setReverbLev(),this.reset(),this.send([144,60,1]),this.send([144,60,0])}})}if(e&&e.customElements){class s extends HTMLElement{constructor(){super()}connectedCallback(){this.getAttr=((e,t)=>{let s=this.getAttribute(e);if(""==s||null==s)return t;switch(typeof t){case"number":return"true"==s?1:(s=+s,isNaN(s)?0:s)}return s}),this.canvas=div.children[0],this.appendChild(div),t.bind(this)(this);const e=this.properties;for(let t in e){const s=e[t];s.observer?(this["_"+t]=s.value,Object.defineProperty(this,t,{get:()=>this["_"+t],set:e=>{this["_"+t]=e,this[s.observer]()}})):this[t]=s}for(let t in e){const s=e[t];this[t]=this.getAttr(t,s.value)}this.setQuality(1),this.init(),this._guiInit.bind(this)(),setInterval(this._guiUpdate.bind(this),100)}}e.customElements.define("webaudio-tinysynth",s)}class s{constructor(e){t.bind(this)(this);for(let e in this.properties)this[e]=this.properties[e].value;this.setQuality(1),e&&(null!=e.useReverb&&(this.useReverb=e.useReverb),null!=e.quality&&this.setQuality(e.quality),null!=e.voices&&this.setVoices(e.voices)),this.init()}}"object"==typeof exports&&"undefined"!=typeof module?module.exports=s:"function"==typeof define&&define.amd?define(function(){return s}):e.WebAudioTinySynth=s}(this),window.synth=new WebAudioTinySynth({quality:1,useReverb:1}),synth.setReverbLev(0);var O,H,G=!1,N=25,F=null,D=null,j=.1,W=0,I=0,z=0;function X(t,s){if((g+=g)>32&&(g=1),synth.actx.createOscillator().connect(synth.actx.destination),o=f,Math.random()>.8&&(o=p),A)var o=randint(0,127);var c,u=0;if(c=abacabmode?nextabacab():60,1===b&&Math.random()>.73)c*=u=y(.5,1.5);else if(2===b&&Math.random()>.2){c*=u=y(.5,1.5)}else{u=0;var q=.9;k&&(q=.3),(b||Math.random()>q)&&Math.random()>.5&&(u=12,Math.random()>.5&&(u=24,k&&(Math.random()>.5?u=48:Math.random()>.8&&(u=36))),Math.random()>.3&&(u=-12,k&&(Math.random()>.5?u=-24:Math.random()>.8&&(u=-36)))),c-=u}var x=0;C&&(x=1);var T=document.querySelector(".lit");l++;var S=!1;if(T){var M=l-1;M<0&&(M=a-1),e[M].classList.contains("toggle")&&(S=!0,l--),T.classList.remove("lit")}e[l<0?a-1:l].classList.add("lit"),l>a-2&&(l=-1+n),S?(c=m.a,o=m.b,Math.random()>.5&&c++,h=!!i.has(l-1),i.has(l+1)&&!w&&(w=!0),v=i.has(l-3)&&i.has(l-2)?2:!!i.has(l-2)&&1):(h=!1,v=!1,m={a:c,b:o}),h&&V&&J(synth.actx,s),synth.send([192,o]);var B=0;if(r&&(B=y(0,.5),Math.random()>.5?(x-=12,Math.random()>.3&&(x+=1)):(x+=12,Math.random()>.5&&(x+=1)),Math.random()>.2&&(r=!1)),d&&Math.random()>.8&&(r=!0),!r||r&&Math.random()>.4)if(synth.send([144,c+x,60],s+L+B),synth.send([144,c+x,0],s+L),2===v){if(Math.random()>.5){synth.send([192,o]);var R=24;synth.send([144,c+x-R,60],s+L),synth.send([144,c+x-R,0],s+L)}}else if(1===v&&Math.random()>.5){synth.send([192,o]);R=12;synth.send([144,c+x-R,60],s+L),synth.send([144,c+x-R,0],s+L)}}for(var Q=synth.actx.createBuffer(1,44100,44100),$=Q.getChannelData(0),K=0;K<44100;K++)$[K]=2*Math.random()-1;function U(e){this.context=e}U.prototype.setup=function(){this.noise=this.context.createBufferSource(),this.noise.buffer=this.noiseBuffer();var e=this.context.createBiquadFilter();e.type="highpass",e.frequency.value=1e3,this.noise.connect(e),this.noiseEnvelope=this.context.createGain(),e.connect(this.noiseEnvelope),this.noiseEnvelope.connect(this.context.destination),this.osc=this.context.createOscillator(),this.osc.type="triangle",this.oscEnvelope=this.context.createGain(),this.osc.connect(this.oscEnvelope),this.oscEnvelope.connect(this.context.destination)},U.prototype.noiseBuffer=function(){for(var e=this.context.sampleRate,t=this.context.createBuffer(1,e,this.context.sampleRate),s=t.getChannelData(0),n=0;n<e;n++)s[n]=2*Math.random()-1;return t},U.prototype.trigger=function(e){this.setup(),this.noiseEnvelope.gain.setValueAtTime(1,e),this.noiseEnvelope.gain.exponentialRampToValueAtTime(.01,e+.2),this.noise.start(e),this.osc.frequency.setValueAtTime(100,e),this.oscEnvelope.gain.setValueAtTime(.7,e),this.oscEnvelope.gain.exponentialRampToValueAtTime(.01,e+.1),this.osc.start(e),this.osc.stop(e+.2),this.noise.stop(e+.2)};var J=(e,t)=>{document.querySelectorAll("a.person")[0].classList.add("hit"),0===l&&ae.trigger(t),setTimeout(()=>{document.querySelectorAll("a.person")[0].classList.remove("hit")},60),function(e,t){var s=e.createOscillator(),n=e.createGain();s.frequency.setValueAtTime(130,t),s.frequency.exponentialRampToValueAtTime(.01,t+.5),n.gain.setValueAtTime(y(2,3),t),n.gain.exponentialRampToValueAtTime(.01,t+.5),s.connect(n),n.connect(e.destination),s.start(t),s.stop(t+.5)}(e,t)},Y=function(e,t){var s=e.createBufferSource();s.buffer=Q;var n=e.createBiquadFilter();n.type="highpass",n.frequency.value=16e3,s.connect(n);var a=e.createGain();n.connect(a),a.connect(e.destination),a.gain.setValueAtTime(.8,t),a.gain.exponentialRampToValueAtTime(.5,t+.05),a.gain.exponentialRampToValueAtTime(.01,t+.1),s.start(t),s.stop(t+.01)};function Z(e,t){z=2,3===R?z=Math.random()>.9?0:Math.random()>.8?1:2:4===R&&(z=Math.random()>.7?0:2);var s=4;if(2!==R&&4!==R||(s=2),!(1==z&&e%2||2==z&&e%s)){var n=!1,a=!1;e%8==0?(a=!0,n=!0):n=!0,R&&n&&(document.querySelectorAll("a.box.person")[1].classList.add("hit"),setTimeout(()=>{document.querySelectorAll("a.box.person")[1].classList.remove("hit")},60),Y(synth.actx,t)),V&&!h&&a&&J(synth.actx,t)}}function ee(){for(;W<synth.actx.currentTime+j;)X(0,W),e=void 0,e=0,1===S?e=.1:2===S&&(e=.5),T=x/4,Math.random()>e&&(T=x/1),W+=60/T*.25,16==++O&&(O=0);var e;F=window.setTimeout(ee,N)}function te(){for(;I<synth.actx.currentTime+j;)Z(H,I),e=void 0,e=2,o&&(e=y(3,7)),I+=60/(x*e)*.25,16==++H&&(H=0);var e;D=window.setTimeout(te,N)}var se=!1;function ne(){if(!se){toggleabacab();var e=document.querySelectorAll("a.box.new-block:not(.person)")[0];e&&e.addEventListener("click",e=>{toggleabacab()})}return se=!0,(G=!G)?(O=0,H=0,W=synth.actx.currentTime,I=synth.actx.currentTime,ee(),te(),"stop"):(window.clearTimeout(F),window.clearTimeout(D),"play")}var ae=new U(synth.actx)}